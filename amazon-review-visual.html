<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amazonæ›¸ç±ãƒ¬ãƒ“ãƒ¥ãƒ¼æ•°ãƒˆãƒ©ãƒƒã‚«ãƒ¼ - ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«è¡¨ç¤º</title>
    
    <!-- Meta tags -->
    <meta name="description" content="Amazonæ›¸ç±ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼æ•°é€²æ—ã‚’ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ã§è¡¨ç¤ºã—ã€ç›®æ¨™é”æˆçŠ¶æ³ã‚’ç¢ºèª">
    <meta name="keywords" content="Amazon, æ›¸ç±, ãƒ¬ãƒ“ãƒ¥ãƒ¼, é€²æ—è¡¨ç¤º, å¯è¦–åŒ–">
    <meta name="author" content="Kindle Review Meter">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“Š</text></svg>">
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/progress.css">
    <link rel="stylesheet" href="css/visual.css">
    <link rel="stylesheet" href="css/share.css">
    
    <!-- Cache control for debugging -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <!-- Preload critical resources with timestamp -->
    <link rel="preload" href="visual.js?v=2.0.1" as="script" crossorigin="anonymous">
    
    <!-- Security headers - Optimized CSP (frame-ancestors must be set via server header) -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'unsafe-inline';
        style-src 'self' 'unsafe-inline' fonts.googleapis.com;
        font-src 'self' fonts.gstatic.com;
        img-src 'self' data: https: ssl-images-amazon.com m.media-amazon.com images-amazon.com;
        connect-src 'self' api.allorigins.win *.amazon.co.jp *.amazon.com cors-anywhere.herokuapp.com;
        form-action 'self';
        base-uri 'self';
        object-src 'none';
        upgrade-insecure-requests;
    ">
    
    <!-- Open Graph meta tags for social sharing -->
    <meta property="og:title" content="Amazonæ›¸ç±ãƒ¬ãƒ“ãƒ¥ãƒ¼æ•°ãƒˆãƒ©ãƒƒã‚«ãƒ¼">
    <meta property="og:description" content="æ›¸ç±ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼æ•°ç›®æ¨™é”æˆã‚’å¯è¦–åŒ–">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://example.com/og-image.png">
    
    <!-- Twitter Card meta tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Amazonæ›¸ç±ãƒ¬ãƒ“ãƒ¥ãƒ¼æ•°ãƒˆãƒ©ãƒƒã‚«ãƒ¼">
    <meta name="twitter:description" content="æ›¸ç±ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼æ•°ç›®æ¨™é”æˆã‚’å¯è¦–åŒ–">
</head>
<body class="visual-page">
    <!-- Main application container -->
    <div id="app" class="app-container visual-container">
        <!-- Loading indicator -->
        <div id="loading" class="loading-overlay">
            <div class="loading-spinner pulse"></div>
            <div class="loading-text">ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
        </div>
        
        <!-- Error fallback -->
        <div id="error-fallback" class="error-fallback" style="display: none;">
            <div class="error-content">
                <h1>âš ï¸ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</h1>
                <p id="error-message">ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p>
                <div class="error-actions">
                    <button onclick="location.reload()" class="btn btn-primary">
                        ğŸ”„ å†èª­ã¿è¾¼ã¿
                    </button>
                    <a href="index.html" class="btn btn-secondary">
                        âš™ï¸ è¨­å®šãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹
                    </a>
                    <button onclick="localStorage.clear(); location.reload()" class="btn btn-secondary">
                        ğŸ—‘ï¸ ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¦å†èª­ã¿è¾¼ã¿
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Share modal template (hidden) -->
    <template id="share-modal-template">
        <div class="share-modal">
            <div class="share-modal-content">
                <div class="share-modal-header">
                    <h3>ğŸ“¤ ã‚·ã‚§ã‚¢</h3>
                    <button class="share-modal-close" aria-label="é–‰ã˜ã‚‹">&times;</button>
                </div>
                <div class="share-modal-body">
                    <div class="share-preview">
                        <img class="share-preview-image" alt="ã‚·ã‚§ã‚¢ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼">
                    </div>
                    <div class="share-actions">
                        <button class="btn btn-primary share-download">
                            ğŸ“¥ ç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                        </button>
                        <button class="btn btn-secondary share-twitter">
                            ğŸ¦ Twitterã§ã‚·ã‚§ã‚¢
                        </button>
                        <button class="btn btn-secondary share-copy">
                            ğŸ“‹ URLã‚’ã‚³ãƒ”ãƒ¼
                        </button>
                    </div>
                    <div class="share-info">
                        <small class="share-details">
                            <!-- ã‚·ã‚§ã‚¢è©³ç´°æƒ…å ±ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Toast notification container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Footer -->
    <footer class="app-footer">
        <div class="footer-content">
            <p>&copy; 2024 Amazonæ›¸ç±ãƒ¬ãƒ“ãƒ¥ãƒ¼æ•°ãƒˆãƒ©ãƒƒã‚«ãƒ¼</p>
            <div class="footer-links">
                <a href="index.html">âš™ï¸ è¨­å®šãƒšãƒ¼ã‚¸</a>
                <a href="#" onclick="showHelp(); return false;">â“ ãƒ˜ãƒ«ãƒ—</a>
                <a href="#" onclick="showKeyboardShortcuts(); return false;">âŒ¨ï¸ ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ</a>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script type="module">
        // Early error handling
        window.addEventListener('error', (event) => {
            console.error('Global error:', event.error);
            showErrorFallback(event.error?.message || event.message);
        });

        window.addEventListener('unhandledrejection', (event) => {
            console.error('Unhandled promise rejection:', event.reason);
            showErrorFallback('éåŒæœŸå‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + event.reason);
        });

        // Utility functions
        function showErrorFallback(message) {
            const loading = document.getElementById('loading');
            const errorFallback = document.getElementById('error-fallback');
            const errorMessage = document.getElementById('error-message');
            
            if (loading) loading.style.display = 'none';
            if (errorFallback) errorFallback.style.display = 'flex';
            if (errorMessage) errorMessage.textContent = message;
        }

        function showToast(message, type = 'info', duration = 3000) {
            const container = document.getElementById('toast-container');
            if (!container) return;

            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <div class="toast-content">
                    <span class="toast-message">${message}</span>
                    <button class="toast-close" onclick="this.parentElement.parentElement.remove()">&times;</button>
                </div>
            `;

            container.appendChild(toast);

            // Animate in
            setTimeout(() => toast.classList.add('show'), 10);

            // Auto remove
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, duration);
        }

        // Help functions
        window.showHelp = function() {
            alert(`
ğŸ“Š ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«è¡¨ç¤ºãƒšãƒ¼ã‚¸

ã€æ©Ÿèƒ½ã€‘
- æ›¸ç±ãƒ¬ãƒ“ãƒ¥ãƒ¼æ•°ã®é€²æ—ã‚’ã‚°ãƒ©ãƒ•ã‚£ã‚«ãƒ«ã«è¡¨ç¤º
- ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ã®é”æˆçŠ¶æ³ã‚’ç¢ºèª
- ã‚·ã‚§ã‚¢ç”¨ç”»åƒã®ç”Ÿæˆã¨SNSæŠ•ç¨¿
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã®ãƒ‡ãƒ¼ã‚¿æ›´æ–°

ã€æ“ä½œæ–¹æ³•ã€‘
- ğŸ”„ æ›´æ–°ãƒœã‚¿ãƒ³: æœ€æ–°ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼æ•°ã‚’å–å¾—
- ğŸ“¤ ã‚·ã‚§ã‚¢ãƒœã‚¿ãƒ³: SNSç”¨ã®ç”»åƒã‚’ç”Ÿæˆ
- â† è¨­å®šã«æˆ»ã‚‹: è¨­å®šãƒšãƒ¼ã‚¸ã«ç§»å‹•

ã€ã‚·ã‚§ã‚¢æ©Ÿèƒ½ã€‘
- ç”»åƒã¨ã—ã¦ä¿å­˜ã—ã¦SNSã«æŠ•ç¨¿å¯èƒ½
- Twitterç”¨ã®æŠ•ç¨¿ãƒ†ã‚­ã‚¹ãƒˆã‚’è‡ªå‹•ç”Ÿæˆ
- URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã‚·ã‚§ã‚¢å¯èƒ½

ã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã€‘
- Ctrl+R: ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
- Ctrl+S: ã‚·ã‚§ã‚¢ç”»åƒã‚’ç”Ÿæˆ
- Esc: ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
            `);
        };

        window.showKeyboardShortcuts = function() {
            alert(`
âŒ¨ï¸ ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ

ã€ãƒ‡ãƒ¼ã‚¿æ“ä½œã€‘
- Ctrl+R: ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
- Ctrl+S: ã‚·ã‚§ã‚¢ç”»åƒã‚’ç”Ÿæˆ

ã€ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã€‘
- Esc: ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‰ã˜ã‚‹

ã€ãã®ä»–ã€‘
- F1: ãƒ˜ãƒ«ãƒ—ã‚’è¡¨ç¤º
- F5: ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿

ğŸ’¡ ãƒ’ãƒ³ãƒˆ: ã»ã¨ã‚“ã©ã®æ“ä½œã¯ãƒã‚¦ã‚¹ã§ã‚‚è¡Œãˆã¾ã™ãŒã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’ä½¿ã†ã¨ã‚ˆã‚ŠåŠ¹ç‡çš„ã«æ“ä½œã§ãã¾ã™ã€‚
            `);
        };

        // Loading management
        let loadingTimeout;
        
        function hideLoading() {
            const loading = document.getElementById('loading');
            if (loading) {
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                }, 300);
            }
            clearTimeout(loadingTimeout);
        }

        // Hide loading after maximum wait time
        loadingTimeout = setTimeout(() => {
            hideLoading();
            showErrorFallback('ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èª­ã¿è¾¼ã¿ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸã€‚');
        }, 10000);

        // Load visual application with version parameter
        import('./visual.js?v=2.0.1')
            .then(module => {
                console.log('âœ… Visual module loaded successfully v2.0.1');
                showToast('ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ', 'success', 2000);
                setTimeout(hideLoading, 500);
            })
            .catch(error => {
                console.error('âŒ Failed to load visual module:', error);
                console.error('ğŸ“Š Error details:', {
                    message: error.message,
                    stack: error.stack,
                    name: error.name,
                    timestamp: new Date().toISOString(),
                    userAgent: navigator.userAgent,
                    url: window.location.href
                });
                showErrorFallback('ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«è¡¨ç¤ºãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
            });

        // Performance monitoring
        window.addEventListener('load', () => {
            const loadTime = performance.now();
            console.log(`ğŸ“Š Visual page loaded in ${loadTime.toFixed(2)}ms`);
            
            if (loadTime > 3000) {
                console.warn('âš ï¸ Slow page load detected:', loadTime);
                showToast('ãƒšãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿ãŒé…ããªã£ã¦ã„ã¾ã™', 'warning', 5000);
            }
        });

        // Network status monitoring
        window.addEventListener('online', () => {
            console.log('ğŸŒ Network: Online');
            showToast('ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šãŒå¾©æ—§ã—ã¾ã—ãŸ', 'success', 3000);
        });

        window.addEventListener('offline', () => {
            console.log('ğŸ“´ Network: Offline');
            showToast('ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šãŒåˆ‡æ–­ã•ã‚Œã¾ã—ãŸã€‚æ›´æ–°æ©Ÿèƒ½ã¯åˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚', 'warning', 5000);
        });

        // Page visibility API for performance optimization
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                console.log('ğŸ‘ï¸ Page hidden - pausing non-critical operations');
            } else {
                console.log('ğŸ‘ï¸ Page visible - resuming operations');
            }
        });

        // Touch gesture support for mobile
        let touchStartX = null;
        let touchStartY = null;

        document.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        });

        document.addEventListener('touchend', (e) => {
            if (touchStartX === null || touchStartY === null) return;

            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;
            
            const deltaX = touchEndX - touchStartX;
            const deltaY = touchEndY - touchStartY;

            // Swipe right to go back (if significant horizontal movement)
            if (Math.abs(deltaX) > Math.abs(deltaY) && deltaX > 100 && Math.abs(deltaY) < 100) {
                // Navigate back to settings
                window.location.href = 'index.html';
            }

            touchStartX = null;
            touchStartY = null;
        });

        // Expose utility functions globally
        window.showToast = showToast;
    </script>

    <!-- Main visual application script loaded via dynamic import above -->
</body>
</html>